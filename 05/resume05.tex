\documentclass[11pt,a4paper]{jarticle}
\usepackage[dvipdfmx]{graphicx}
\usepackage{url}

\renewcommand{\baselinestretch}{1.05} 
\marginparwidth=0cm
\topmargin=-1cm
\headheight=0.3cm
\headsep=0.7cm
\oddsidemargin=0cm
\evensidemargin=0cm
%\textwidth=43zw
\textwidth=15.92cm
%\textheight=43.3\baselineskip
\baselineskip = 0.5744cm
\textheight=43\baselineskip

\itemsep=0.05\baselineskip
\parsep=0pt
\topsep=0.01\baselineskip
\partopsep=0pt
\listparindent=0zw

%% header and footer
\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{2014年度 春学期授業}
\chead{インタラクティブ・アート実習}
\rhead{担当教員: 松下 光範}
\cfoot{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\usepackage{ascmac}
\usepackage{listings,jlisting}
\usepackage{color}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{colFunc}{rgb}{1,0.07,0.54}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{colID}{rgb}{0.63,0.44,0}
\definecolor{rulesepcolor}{gray}{0.666}
\lstset{
  language=Java,%プログラミング言語によって変える。
  basicstyle={\ttfamily\small},
  keywordstyle={\color{OliveGreen}},
  %[2][3]はプログラミング言語によってあったり、なかったり
  keywordstyle={[2]\color{colFunc}},
  keywordstyle={[3]\color{CadetBlue}},%
  commentstyle={\color{Brown}},
  %identifierstyle={\color{colID}},
  stringstyle=\color{blue},
  tabsize=2,
  %frame=trBL,
  %numbers=left,
  numberstyle={\ttfamily\small},
  breaklines=true,%折り返し
  %backgroundcolor={\color[gray]{.95}},
  framexleftmargin=0mm,
  frame=shadowbox,
  rulesepcolor=\color{rulesepcolor},
  captionpos=b
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

% title
\section*{\LARGE{第5講 物体とセンサとの距離をはかる}}
赤外線センサを用いて、センサと物体との距離を測定する。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{赤外線センサとは}
Arduino で、物体との距離を非接触で測定するには「超音波方式」と「赤外線方式」がある。
赤外線センサは、(その名の通り)赤外線を使うことで距離を測定する。
赤外線センサは、物体から人体まで幅広いものの距離を検出することができる。
今回利用する赤外線センサは、大体 10cm 〜 80cm までの距離を測定することができる。
赤外線センサは、外光による影響を受けやすいため、使用する環境によっては注意する必要がある。
赤外線センサよりも、もう少し長い距離を測定したい場合は、超音波センサを使うと良い。

\begin{itembox}{注意!}
 赤外線センサは、とてもデリケートで配線の向きを間違えただけでも破損してしまう。
 PC に接続する前に配線が正しいかどうか、もう一度確認すること。
\end{itembox}

\section{回路を組み立てる}

回路図

\subsection*{TRY1}
回路図を参考に、Arduino と赤外線センサを接続する。必ず、Arduino は PC から取り外した状態で配線すること。

\subsection*{TRY2}
Processing の println 文を使って、赤外線センサが取得できる数値の範囲を確認する。
わからなければ、前回・前々回のプログラムコードを参考にすること。

[ Point ]
 赤外線センサと物体の距離が変わると、数値がどのように変化するかに着目する。得られた数
値を <TRY2> で使うので、メモしておくと良いでしょう。

\subsection*{TRY3}
前回の実習で参考にあげた map 関数を利用して、電子ものさしを作る。
\begin{enumerate}
 \item テキストで、距離を表示する
 \item 長さをバー状に表示してみる
\end{enumerate}

[ Hint 1 ]
 センサの値と、実際の距離の計測値をマッピングする必要がある。
(a < bとして、)
!
map(gainer.analogInput[0],
<< aの時のセンサ値 >>, << bの時のセンサ値 >>, << aの実測値 >>,<< bの実測値 >>);
[ Hint 2 ]

\begin{lstlisting}
 import processing.gainer.*;
 Gainer gainer;
 void setup() {
   size(400, 150);
   colorMode(RGB, 256);
   gainer = new Gainer(this);
   gainer.beginAnalogInput();
 }
 
 void draw() {
   //Gainer miniの ain0 値をprintln文で表示
   println(gainer.analogInput[0]);
   //背景色の指定
   background(0);
   //センサで取得した値を実際の距離にマッピングする
   float value = map(gainer.analogInput[0], 180, 10, 5, 90);
   stroke(255);
   strokeWeight(20);
   line(0, height/2, 4*value, height/2);
}
\end{lstlisting}


Processingで座標系を変換する
translate(x, y);
!
原点(デフォルトでは 0, 0)の位置をx, yに移動する。
rotate(<<ラジアン角>>);
!
原点を中心に<<ラジアン角>>分、回転させる。
radians(int degree);
!
degree(度) を ラジアン角に変換する。!
scale(<<倍率>>);
!
座標を<<倍率>>に拡大(縮小)する。
pushMatrix();
!
現在の座標系を保存する。
popMatrix();
!
保存しておいた座標系を読み出す。

\subsection*{TRY4}
translateとrotateを使って、Processingで幾何学的な模様を書いてみる。

[ Hint ]
\begin{lstlisting}
 int i = 0;
 
 void setup() {
   size(400, 400);
   colorMode(HSB, 256);
   background(0);
   rectMode(CENTER);
   frameRate(30);
 }
 
 void draw() {
   int angle = 12;
   float x = 0.5;

   translate(width/2, height/2);
   fill(i*0.5, 256, 256);

   pushMatrix();
   rotate(radians(i*angle));
   translate(i*x, 0);
   rect(0, 0, 10, 10);
   popMatrix();

   i++;
} 
\end{lstlisting}

\end{document}